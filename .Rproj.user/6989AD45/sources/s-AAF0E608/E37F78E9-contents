## Skript pro vygenerování zadání studujícím na PV1

## FrK vytvořil 2021-03-13
## FrK upravil  2021-05-11
## encoding: windows-1250


# Cílem je vybrat unikátních 40/50 pojmů a rozdělit je do čtveřic/pětic,
# a pak z každé čtveřice/pětice udělat jeden string, který se uloží do jednoho
# políčka matice, která bude mít tolik řádek, kolik je studentů a 10 sloupců 
# (pro každé zadání jeden). A nakonec půjde o to, připojit k nim sloupec s e-maily a
# celou tuto matici exportovat jako excelový soubor, který pak půjde načíst do C4S.
rm(list = ls())

### Package
library(dplyr)
library(writexl)
library(readxl)


### Vstupní objekty
pojmy = c("pohlaví", "věk", "vzdělání", "příjem", "počet dětí", "počet osob v domácnosti", 
          "počet knih v domácí knihovně", 
          "délka spánku", "zdravotní stav", "spokojenost se životem", 
          
          "míra samostatnosti", "znalost soc. služeb", "intenzita užívání soc. služeb", 
          "frekvence užívání soc. služeb", "spokojenost se soc. službami", "zájem o politiku",
          "vlastnictví mobilního telefonu", "vlastnictví TV přijímače", "intenzita sledování TV",
          "intenzita užívání sociálních sítí", 
          
          "uplatnění vlastní vůle při řešení situace",
          "předsudky", "lidská práva", "osobní svobody", 
          "znalost právních norem",
          "znalost vlastních práv", 
          "přijímání darů", "dávání darů", 
          "podmínky poskytování sociální služby", 
          "možnosti poskytování sociální služby", 
          
          "informovanost o sociální službě", 
          "požadavky na soc. službu", 
          "odmítnutí poskytnutí soc. služby", 
          "uzavření smlouvy o poskytování soc. služby",
          "porozumění obsahu a účelu smlouvy", 
          "sjednání rozsahu poskytování soc. služby",
          "sjednání průběhu poskytování soc. služby ", 
          "osobní cíle", "poslání soc. služby",
          "plánování sociální služby",
          
          "hodnocení naplnění cílů soc. služby", 
          "dokumentace o poskytování sociální služby",
          "stížnosti na kvalitu soc. služby", 
          "stížnosti na způsob poskytování soc. služby",
          "informovanost o možnosti stížnosti", 
          "forma stížnosti", "způsob vyřízení stížnosti",
          "informovanost zaměstnanců o možnostech stížností",
          "evidence stížností",
          "prošetření vyřizování stížností",
          
          "příležitost využít běžně dostupné veřejné služby",
          "zprostředkování služeb", 
          "kontakty s přirozeným sociálním prostředím",
          "vztahy s přirozeným sociálním prostředím",
          "počet zaměstnanců", "počet úvazků zaměstnanců",
          "kvalifikační požadavky na zaměstnance",
          "osobnostní předpoklady zaměstnanců",
          "zaškolování nových zaměstnanců", "kapacita sociální služby",
          
          "pravidelné hodnocení zaměstnanců", 
          "program dalšího vzdělávání zaměstnanců", 
          "systém finančního oceňování zaměstnanců",
          "systém morálního oceňování zaměstnanců",
          "podpora zaměstnanců od nezávislého odborníka",
          "místo poskytování soc. služby",
          "čas poskytování soc. služby",
          "materiální podmínky soc. služby", "technické podmínky soc. služby", 
          "hygienické podmínky soc. služby",
          
          "důstojné prostředí", "nouzová situace", "havarijní situace",
          "řešení situace", 
          "seznámení zaměstnanců s řešením nouzové situace",
          "seznámení klientů s řešením nouzové situace",
          "seznámení klientů s řešením havarijní situace",
          "kvalita sociální služby", "poslání soc. služby", "cíle soc. služby")  # Seznam pojmů
length(pojmy)  # kontrola počtu pojmů
nchar(pojmy)  # kontrola délky pojmů
nchar(pojmy) %>% max()
#maily = read_xls("getStudentiByPredmet-2021-03-16-6-35.xls") %>%  # Emaily studentů plus můj
maily = read_xls("OpravyPV1.xls") %>%  
    select(email) %>% as.matrix() %>% as.vector() %>% c("kalvas@kss.zcu.cz", .)  
studs = length(maily)  # Počet studujících

# Matice, která bude obsahovat zadání pro každého studenta, 
# 10 čtveřic/pětic, v každé buňce jedna, tedy,
# matice má tolik řádek, kolik studentů, a 10 sloupců jako 10 hypotéz.
zadaniTen = matrix(rep("0", studs * 10), ncol = 10)  
delky = matrix(rep(0, studs * 10), ncol = 10)  # Matice pro kontrolu délek stringů v 'zadaniTen'

# Matice, která obsahuje jedno zadání pro každého studenta, tj. 20 pojmů najednou,
# matice má tolik řádek, kolik studentů a 1 sloupec.
zadaniOne = matrix(rep("0", studs), ncol = 1)


### Cykly, které vygenerují matici se zadáním
for (s in 1:studs) {  # cyklus, který iteruje přes všechny studující
  m = pojmy %>% sample(., 50, replace = F) %>% 
    matrix(., ncol = 5, byrow = F)  # Vylosování pojmů a jejich rozdělení do 10 čtveřic/pětic
  for(z in 1:10){  # cyklus, který iteruje přes 10 zadání hypotéz u konkrétního studujícího 's'
    radek = m[z,]  # Vybereme příslušný řádek z matice s výběrem pojmů
    zadaniTen[s, z] =  # Vytvoříme string včetně html značek a uložíme do matice 'zadani'
      paste0("Hypotéza ", z, ": ", paste0(paste0("<u>", radek[1:5], "</u>"), collapse = "; "))
  }
  v = pojmy %>% sample(., 20, replace = F)
  zadaniOne[s, ] = paste0(paste0("<u>", v, "</u>"), collapse = "; ")
}
delky = nchar(zadaniTen)
max(delky)
zadaniOne %>% nchar() %>% max()

### Připojení e-mailů
zadaniTen = cbind(maily, zadaniTen)
zadaniOne = cbind(maily, zadaniOne)


### Export do excelu
dat = zadaniTen %>% as_tibble() 
names(dat) = c("email", paste0("hyp", 1:10))
write_xlsx(dat, "TenOprava.xlsx")

dat = zadaniOne %>% as_tibble() 
names(dat) = c("email", "zadání")
write_xlsx(dat, "OneOprava.xlsx")



# 
# dat = zadaniTen %>% as_tibble() 
# names(dat) = c("email", paste0("hyp", 1:10))
# write_xlsx(dat[1,], "TenTest.xlsx")
# 
# dat = zadaniOne %>% as_tibble() 
# names(dat) = c("email", "zadání")
# write_xlsx(dat[1,], "OneTest.xlsx")


